{% extends "base.html" %}

{% block title %} Card Values {% endblock %}

{% block inner_content %}
    {{ super() }}
    <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


    <div class="row">
        <div class="col-md-2"></div>
        <div id="content-col" class="col-md-8">
            <div id="ownership" style="width:100%">
                <select class="form-control"
                        onchange="ownership=this.value; updateCardTable();">
                    <option value="unowned">Unowned</option>
                    <option value="owned">Owned</option>
                    <option value="all">All</option>
                </select>
            </div>


            <div id="card-table" class="text-center row">
                <div class="space-t"></div>
                {#TODO remove duplication with header of card_values.html#}
                <table id="card-value" class="table vertical-align col-md-8">
                    <thead>
                    <tr class="row">
                        <th class="col-md-4 no-padding">
                            Sort by:
                        </th>
                        <th class="col-md-3 text-center btn {% if sort=="craft" %} bg-primary {% endif %}"
                            onclick="sort='craft'; page=0; ownership='unowned'; updateCardTable()">
                            Crafting Efficiency ▼

                        </th>
                        <th class="col-md-3 text-center btn {% if sort=="value" %} bg-primary {% endif %}"
                            onclick="sort='value'; page=0; ownership='unowned'; updateCardTable()">
                            Value ▼
                        </th>
                    </tr>
                    </thead>
                </table>
                Loading Values...
            </div>
            <div id="card-table-pagination" class="text-center row">
                <nav aria-label="Card values page">
                    <ul id="pagination" class="pagination">
                        <li class="page-item">
                            <button onclick="page=0; updateCardTable()">
                                First
                            </button>
                        </li>

                        <li class="page-item">
                            <button onclick="page=page-1; updateCardTable()">
                                Previous
                            </button>
                        </li>
                        <li class="pagination-info">
                            <span id="current-page">1</span>
                        </li>
                        <li class="page-item" onclick="page=page+1; updateCardTable()">
                            <button>Next</button>
                        </li>
                        <li class="page-item" onclick="page=-1; updateCardTable()">
                            <button>Last</button>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="col-md-2"></div>
    </div>


{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        let page = 0;
        let sort = "craft";
        let ownership = "unowned";

        function updateCardTable() {
            console.log(page);
            $.get({
                url: "/card_values/" + page + "/" + sort + "/" + ownership,
            }).done(function (data) {
                console.log(data);
                $("#card-table").html(data);
                $("#current-page").html(page);
                {#Show card on hover#}
                $('*[rel=popover]').popover({
                    html: true,
                    trigger: 'hover',
                    content: function () {
                        return '<div class="card-tooltip-image">' +
                            '<img src="' + $(this).data('img') + '" />' +
                            '<div>' + $(this).data("name") + '</div>' +
                            '</div>';
                    }
                });
            }).fail(function (jqxhr, textStatus, error) {
                const err = textStatus + ", " + error;
                console.log("Request Failed: " + err);
                $("#card-table").html("<h1>Something's gone very wrong.</h1>");
            });
        }

        $(document).ready(updateCardTable());
    </script>

{% endblock %}